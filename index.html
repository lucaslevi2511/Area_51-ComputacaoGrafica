<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Area 51</title>

    <script id="vertex-shader" type="notjs">
        attribute vec4 position;
        attribute vec3 normal;
        attribute vec2 texCoord;

        uniform mat4 transf;
        uniform mat4 view;
        uniform mat4 projection;

        varying vec3 v_normal;
        varying vec3 v_worldPosition;
        varying vec2 v_texCoord;

        void main() {
            v_texCoord = texCoord;
            vec4 worldPos = transf * position;
            v_worldPosition = worldPos.xyz;
            v_normal = mat3(transf) * normal;
            gl_Position = projection * view * worldPos;
        }
    </script>

    <script id="frag-shader" type="notjs">
        precision mediump float;
        uniform sampler2D tex;
        varying vec3 v_normal;
        varying vec3 v_worldPosition;
        varying vec2 v_texCoord;

        uniform vec3 u_lightPosStatic;
        uniform vec3 u_lightPosDynamic;
        uniform vec3 u_viewPosition;

        void main() {
            float squares_vector_sum = sqrt(v_normal.x * v_normal.x + v_normal.y * v_normal.y + v_normal.z * v_normal.z);
            vec3 N = v_normal / squares_vector_sum;

            vec3 viewDir = u_viewPosition - v_worldPosition;
            squares_vector_sum = sqrt(viewDir.x * viewDir.x + viewDir.y * viewDir.y + viewDir.z * viewDir.z);
            vec3 V = viewDir / squares_vector_sum;

            vec3 lightDir = u_lightPosStatic - v_worldPosition;
            squares_vector_sum = sqrt(lightDir.x * lightDir.x + lightDir.y * lightDir.y + lightDir.z * lightDir.z);
            vec3 Lstatic = lightDir / squares_vector_sum;

            lightDir = u_lightPosDynamic - v_worldPosition;
            squares_vector_sum = sqrt(lightDir.x * lightDir.x + lightDir.y * lightDir.y + lightDir.z * lightDir.z);
            vec3 Ldynamic = lightDir / squares_vector_sum;

            float dotNL = (N.x * Lstatic.x) + (N.y * Lstatic.y) + (N.z * Lstatic.z);
            float diffstatic = max(dotNL, 0.0);

            dotNL = (N.x * Ldynamic.x) + (N.y * Ldynamic.y) + (N.z * Ldynamic.z);
            float diffdynamic = max(dotNL, 0.0);

            vec3 I = -Lstatic;
            float dotNI = (N.x * I.x) + (N.y * I.y) + (N.z * I.z);
            vec3 Rstatic = I - 2.0 * dotNI * N;

            I = -Ldynamic;
            dotNI = (N.x * I.x) + (N.y * I.y) + (N.z * I.z);
            vec3 Rdynamic = I - 2.0 * dotNI * N;

            float dotRV = (Rstatic.x * V.x) + (Rstatic.y * V.y) + (Rstatic.z * V.z);
            float specstatic = pow(max(dotRV, 0.0), 50.0);

            dotRV = (Rdynamic.x * V.x) + (Rdynamic.y * V.y) + (Rdynamic.z * V.z);
            float specdynamic = pow(max(dotRV, 0.0), 50.0);

            vec3 texColor = texture2D(tex, v_texCoord).rgb;
            float ambient = 0.2;
            float lightFactor = (ambient + (diffstatic + diffdynamic) + (specstatic + specdynamic) * 0.5);

            gl_FragColor = vec4(lightFactor * texColor, 1.0);
        }
    </script>

    <script type="module" src="main.js"></script>
</head>

<body>
    <div style="text-align: center;">
        <canvas id="glcanvas1" width="600" height="420"></canvas>
    </div>
</body>
</html>
